var Dt=Object.defineProperty;var _t=(s,t,e)=>t in s?Dt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var p=(s,t,e)=>_t(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();var it=(s=>(s.Road="road",s.Building="building",s.Water="water",s))(it||{});class Gt{constructor(t,e){p(this,"width");p(this,"height");p(this,"tiles");p(this,"pois");this.width=t,this.height=e,this.tiles=[],this.pois=[],this.initializeGrid()}initializeGrid(){for(let t=0;t<this.height;t++){const e=[];for(let i=0;i<this.width;i++)e.push({type:"road",walkable:!0});this.tiles.push(e)}}generateCity(){for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)n%8===0||i%8===0?this.setTile(n,i,"road",!0):n%8>1&&n%8<7&&i%8>1&&i%8<7&&(n*73+i*31)%10<7&&this.setTile(n,i,"building",!1);const e=[[2,3],[5,1],[1,6],[4,2],[6,5],[3,4],[7,0],[0,7],[2,1],[5,6]];for(const[i,n]of e)this.setTile(i,n,"water",!1),this.setTile(this.width-1-i,this.height-1-n,"water",!1);this.initializePOIs()}initializePOIs(){this.pois=[{id:"guild-hall",name:"Guild Hall",pos:{x:32,y:32},footprint:{x:2,y:2}},{id:"tavern",name:"Tavern",pos:{x:16,y:16},footprint:{x:2,y:2}},{id:"market",name:"Market",pos:{x:48,y:16},footprint:{x:3,y:3}},{id:"mine",name:"Mine",pos:{x:8,y:48},footprint:{x:2,y:2}},{id:"forest",name:"Forest",pos:{x:56,y:48},footprint:{x:3,y:3}}],this.pois.forEach(t=>{var n,o;const e=((n=t.footprint)==null?void 0:n.x)||1,i=((o=t.footprint)==null?void 0:o.y)||1;for(let r=0;r<i;r++)for(let a=0;a<e;a++)this.setTile(t.pos.x+a,t.pos.y+r,"road",!0)})}getTile(t,e){return this.isInBounds(t,e)?this.tiles[e][t]:null}setTile(t,e,i,n){this.isInBounds(t,e)&&(this.tiles[e][t]={type:i,walkable:n})}isWalkable(t,e){const i=this.getTile(t,e);return i!==null&&i.walkable}isInBounds(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height}getPOIs(){return[...this.pois]}getPOI(t){return this.pois.find(e=>e.id===t)}}function ct(s,t){return Math.abs(s.x-t.x)+Math.abs(s.y-t.y)}function xt(s,t){return s.x===t.x&&s.y===t.y}function lt(s){return`${s.x},${s.y}`}function K(s,t,e){if(xt(s,t))return[];if(!e.isWalkable(t.x,t.y))return[];const i=new Map,n=new Set,o={pos:s,parent:null,g:0,h:ct(s,t),f:ct(s,t)};i.set(lt(s),o);const r=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];for(;i.size>0;){let a=null,d=1/0;for(const l of i.values())l.f<d&&(d=l.f,a=l);if(!a)break;if(xt(a.pos,t))return qt(a);const c=lt(a.pos);i.delete(c),n.add(c);for(const l of r){const h={x:a.pos.x+l.x,y:a.pos.y+l.y},u=lt(h);if(n.has(u)||!e.isWalkable(h.x,h.y))continue;const m=a.g+1,f=i.get(u);if(f)m<f.g&&(f.parent=a,f.g=m,f.f=m+f.h);else{const y=ct(h,t),w={pos:h,parent:a,g:m,h:y,f:m+y};i.set(u,w)}}}return[]}function qt(s){const t=[];let e=s;for(;e!==null;)t.unshift(e.pos),e=e.parent;return t.length>0&&t.shift(),t}function Ut(s,t){for(const e of s)if(!t.isWalkable(e.x,e.y))return!1;return!0}class Wt{constructor(t){p(this,"mapWidth");p(this,"entitiesByCell");p(this,"sellersByItem");p(this,"entitiesByPoi");this.mapWidth=t,this.entitiesByCell=new Map,this.sellersByItem=new Map,this.entitiesByPoi=new Map}getCellId(t,e){return t+e*this.mapWidth}getCellPos(t){return{x:t%this.mapWidth,y:Math.floor(t/this.mapWidth)}}addEntityToCell(t,e){const i=this.getCellId(e.x,e.y);let n=this.entitiesByCell.get(i);n||(n=new Set,this.entitiesByCell.set(i,n)),n.add(t)}removeEntityFromCell(t,e){const i=this.getCellId(e.x,e.y),n=this.entitiesByCell.get(i);n&&(n.delete(t),n.size===0&&this.entitiesByCell.delete(i))}moveEntity(t,e,i){e.x===i.x&&e.y===i.y||(this.removeEntityFromCell(t,e),this.addEntityToCell(t,i))}getEntitiesInCell(t){const e=this.getCellId(t.x,t.y);return this.entitiesByCell.get(e)||new Set}getEntitiesInRadius(t,e){const i=new Set;for(let n=-e;n<=e;n++)for(let o=-e;o<=e;o++){const r=t.x+o,a=t.y+n;Math.abs(o)+Math.abs(n)<=e&&this.getEntitiesInCell({x:r,y:a}).forEach(l=>i.add(l))}return i}addSeller(t,e){let i=this.sellersByItem.get(e);i||(i=new Set,this.sellersByItem.set(e,i)),i.add(t)}removeSeller(t,e){const i=this.sellersByItem.get(e);i&&(i.delete(t),i.size===0&&this.sellersByItem.delete(e))}getSellersOfItem(t){return this.sellersByItem.get(t)||new Set}updateSellerIndex(t,e,i,n){n===0&&i>0?this.addSeller(t,e):n>0&&i===0&&this.removeSeller(t,e)}addEntityToPOI(t,e){let i=this.entitiesByPoi.get(e);i||(i=new Set,this.entitiesByPoi.set(e,i)),i.add(t)}removeEntityFromPOI(t,e){const i=this.entitiesByPoi.get(e);i&&(i.delete(t),i.size===0&&this.entitiesByPoi.delete(e))}getEntitiesAtPOI(t){return this.entitiesByPoi.get(t)||new Set}clear(){this.entitiesByCell.clear(),this.sellersByItem.clear(),this.entitiesByPoi.clear()}getDebugInfo(){let t=0;this.entitiesByCell.forEach(n=>{t+=n.size});let e=0;this.sellersByItem.forEach(n=>{e+=n.size});let i=0;return this.entitiesByPoi.forEach(n=>{i+=n.size}),{cellCount:this.entitiesByCell.size,itemCount:this.sellersByItem.size,poiCount:this.entitiesByPoi.size,totalCellEntities:t,totalItemSellers:e,totalPoiEntities:i}}}function zt(s,t){const e=[],i=new Map;for(const o of s){const r=t.getCellId(o.pos.x,o.pos.y);let a=i.get(r);a||(a=new Set,i.set(r,a)),a.add(o.id)}const n=new Set;for(const o of s){const r=t.getCellId(o.pos.x,o.pos.y);n.add(r);const a=t.getEntitiesInCell(o.pos),d=i.get(r)||new Set;for(const c of d)a.has(c)||e.push(`Spatial index missing entity ${c} at cell (${o.pos.x}, ${o.pos.y})`);for(const c of a)d.has(c)||e.push(`Spatial index has extra entity ${c} at cell (${o.pos.x}, ${o.pos.y})`)}return{valid:e.length===0,errors:e}}function jt(s,t){const e=[],i=new Map;for(const n of s)if(n.inventory){for(const[o,r]of n.inventory.entries())if(r>0){let a=i.get(o);a||(a=new Set,i.set(o,a)),a.add(n.id)}}for(const[n,o]of i.entries()){const r=t.getSellersOfItem(n);for(const a of o)r.has(a)||e.push(`Inventory index missing seller ${a} for item ${n}`)}for(const n of s)if(n.inventory)for(const[o,r]of n.inventory.entries()){const a=t.getSellersOfItem(o);r>0&&!a.has(n.id)&&e.push(`Entity ${n.id} has item ${o} but is not in seller index`),r===0&&a.has(n.id)&&e.push(`Entity ${n.id} has 0 of item ${o} but is in seller index`)}return{valid:e.length===0,errors:e}}function Qt(s,t,e){const i=zt(s,t),n=jt(s,t);return{valid:i.valid&&n.valid,errors:[...i.errors,...n.errors]}}function Xt(s){s.valid?console.log("‚úì All indices are valid"):(console.error("‚úó Index validation failed:"),s.errors.forEach(t=>console.error(`  - ${t}`)))}function U(s,t,e,i,n){if(i<=0)return!0;const o=wt(s,t),r=wt(s,e);return o<i?!1:(Pt(s,t,o-i),Pt(s,e,r+i),!0)}function wt(s,t){if(t==="city")return s.cityTreasury;if(t==="guild")return s.guildTreasury||0;if(t==="player")return s.player.gold;{const e=s.npcs.find(i=>i.id===t);return e?e.money:0}}function Pt(s,t,e){if(t==="city")s.cityTreasury=e;else if(t==="guild")s.guildTreasury!==void 0&&(s.guildTreasury=e);else if(t==="player")s.player.gold=e;else{const i=s.npcs.find(n=>n.id===t);i&&(i.money=e)}}function pt(s){let t=s.cityTreasury;s.guildTreasury!==void 0&&(t+=s.guildTreasury),t+=s.player.gold;for(const e of s.npcs)t+=e.money;return t}function Jt(s,t){const e=pt(s),i=e-t,n=Math.abs(i)<.01;return n||console.error(`[Economy] Gold mismatch! Expected: ${t}, Actual: ${e}, Diff: ${i}`),{valid:n,actual:e,expected:t,diff:i}}function Yt(s,t,e,i){s.cityTreasury=i.nextInt(t,e),s.guildTreasury!==void 0&&(s.guildTreasury=0),console.log(`[Economy] Initialized with city treasury: ${s.cityTreasury} gold`),console.log(`[Economy] Total economy gold: ${pt(s)} gold`)}function Kt(s){s.needs||(s.needs={hunger:50,social:50,fun:50})}function Et(s){return s.needs||Kt(s),s.needs}function st(s){return Math.max(0,Math.min(100,s))}function W(s,t,e){const i=Et(s);i[t]=st(i[t]+e)}function T(s,t,e){W(s,t,e)}function Zt(s,t){const e=Et(s),i=1-t.hungerSignal,n=st((.5*(1-t.stress)+.5*t.mood)*100);e.hunger=st(i*100),e.fun=st(t.mood*100),e.social=n}function Vt(s,t,e){if(!s.relations)return 0;for(const[i,n]of s.relations.entries())if(i===t||i===e){const o=i===t?e:t;return n.get(o)||0}return 0}function te(s,t,e,i){i=Math.max(-100,Math.min(100,i)),s.relations||(s.relations=new Map);let n=s.relations.get(t);n||(n=new Map,s.relations.set(t,n)),n.set(e,i);let o=s.relations.get(e);o||(o=new Map,s.relations.set(e,o)),o.set(t,i)}function ee(s,t,e,i){const n=Vt(s,t,e);te(s,t,e,n+i)}function St(s,t,e,i){let n=0;switch(i){case"chat":n=2;break;case"trade":n=5;break;case"conflict":n=-10;break;case"help":n=8;break}return n+=Math.random()*2-1,ee(s,t,e,n),n}function Ct(s){return s.inventory||(s.inventory=new Map),s.inventory}function _(s,t,e,i){const n=Ct(s),o=n.get(t)||0,r=o+e;n.set(t,r),i.updateSellerIndex(s.id,t,r,o)}function Z(s,t,e,i){const n=Ct(s),o=n.get(t)||0;if(o<e)return!1;const r=o-e;return r===0?n.delete(t):n.set(t,r),i.updateSellerIndex(s.id,t,r,o),!0}function ie(s,t){return s.inventory&&s.inventory.get(t)||0}function V(s,t,e){return ie(s,t)>=e}const nt=1e-9;function g(s,t){return s[t]??0}function j(s,t,e){if(Math.abs(e)<1e-12)return;const i=(s[t]??0)+e;i<=nt?delete s[t]:s[t]=i}function mt(s,t){const e={};for(const[i,n]of Object.entries(s)){const o=n*t;o>nt&&(e[i]=o)}return e}function Q(s,t){const e={...s};for(const[i,n]of Object.entries(t))j(e,i,n);return e}function se(s){return Object.values(s).reduce((t,e)=>t+e,0)}function S(s,t,e){return Math.max(t,Math.min(e,s))}class O{constructor(t){p(this,"inputs");p(this,"outputs");p(this,"rate");p(this,"condition");this.inputs=t.inputs,this.outputs=t.outputs,this.rate=t.rate,this.condition=t.condition??(()=>1)}apply(t,e){const i=S(this.condition(t),0,3);if(i<=0)return;let n=Number.POSITIVE_INFINITY;for(const[r,a]of Object.entries(this.inputs)){if(a<=0)continue;const d=g(t.mix,r);n=Math.min(n,d/a)}if(!Number.isFinite(n)||n<=0)return;const o=this.rate*e*i*n;if(!(o<=0)){for(const[r,a]of Object.entries(this.inputs))j(t.mix,r,-a*o);for(const[r,a]of Object.entries(this.outputs))j(t.mix,r,a*o)}}}function At(s,t,e=10){return i=>{var o;const n=((o=i.tags)==null?void 0:o[s])??0;return 1/(1+Math.exp(-e*(n-t)))}}function Lt(s,t,e){const i={mix:s.stomach??{},temperature:g(s.body,"TEMP"),pH:g(s.body,"PH"),catalysts:Object.fromEntries(Object.entries(s.body).filter(([r])=>r.startsWith("ENZ_")))};for(const r of t)r.apply(i,e);s.stomach=i.mix;const n=S(.1*e,0,.5),o=mt(s.stomach,n);s.stomach=Q(s.stomach,mt(o,-1)),s.body=Q(s.body,o),ne(s,e)}function ne(s,t){const e=g(s.body,"GLU"),i=g(s.body,"ATP"),n=g(s.body,"SER"),o=g(s.body,"H2O"),r=g(s.body,"O2"),a=g(s.body,"OX_STRESS")+.5*g(s.body,"OXIDIZER"),d=Math.max(0,.3-o)+g(s.body,"DEHYDRATION_SIGNAL"),c=Math.max(0,.3-r),l=Math.max(0,g(s.body,"PH_ACID")+g(s.body,"PH_BASE")+g(s.body,"PH_SHIFT")-g(s.body,"PH_BUFFER")),h=g(s.body,"CHELATED_METAL"),u=g(s.body,"STRESS")+g(s.body,"CORT")+g(s.body,"ADREN")+a+l+d+h,m=g(s.body,"SOCIAL_BOND"),f=g(s.body,"DOPA");s.energy=S((s.energy??.5)+(.05*i+.02*e-.04*c-.04*l-.03*d)*t,0,1),s.pain=S((s.pain??0)+(.05*a+.04*l+.04*d+.02*h)*t,0,1),s.mood=S((s.mood??.5)+(.04*n-.02*u-.03*l-.02*d)*t,0,1),s.focus=S((s.focus??.5)+(.04*f-.03*u)*t,0,1),s.hunger=S((s.hunger??.5)+(.03-.05*e-.04*i)*t,0,1),s.thirst=S((s.thirst??.5)+(.03+.05*d-.08*o)*t,0,1),s.social=S((s.social??.5)+(.04*m-.02*u)*t,0,1)}function Nt(s,t,e){const i={mix:{...s},temperature:t.temperature,catalysts:t.catalysts,tags:t.tags},n=t.steps??10,o=t.dt??1;for(let r=0;r<n;r++)for(const a of e)a.apply(i,o);return i.mix}function ft(s){const t=g(s,"GLU"),e=g(s,"ATP"),i=g(s,"SER"),n=g(s,"H2O"),o=g(s,"O2"),r=g(s,"OX_STRESS")+.5*g(s,"OXIDIZER"),a=Math.max(0,.3-n)+g(s,"DEHYDRATION_SIGNAL"),d=Math.max(0,.3-o),c=Math.max(0,g(s,"PH_ACID")+g(s,"PH_BASE")+g(s,"PH_SHIFT")-g(s,"PH_BUFFER")),l=g(s,"CHELATED_METAL"),h=g(s,"STRESS")+g(s,"CORT")+g(s,"ADREN")+r+c+a+l,u=g(s,"DOPA");return{energy:S(.5+(.05*e+.02*t-.04*d-.04*c-.03*a),0,1),pain:S(.05*r+.04*c+.04*a+.02*l,0,1),mood:S(.5+(.04*i-.02*h-.03*c-.02*a),0,1),focus:S(.5+(.04*u-.03*h),0,1),hungerSignal:S(.5+(.03-.05*t-.04*e),0,1),thirstSignal:S(.5+(.03+.05*a-.08*n),0,1),stress:S(h,0,1)}}const oe=[new O({inputs:{H2O:.5},outputs:{HUMIDADE:.5},rate:.05,condition:At("rainfall",.6)}),new O({inputs:{MINERAL_DUST:1,H2O:.2},outputs:{SALT:.3},rate:.05})],yt=[new O({inputs:{GLU:1,O2:1},outputs:{ATP:1,CO2:1},rate:.2}),new O({inputs:{FRUCT:1,O2:1},outputs:{ATP:.8,CO2:1},rate:.18}),new O({inputs:{ATP:1},outputs:{TEMP:.02},rate:.1}),new O({inputs:{ATP:1,OXIDIZER:.4},outputs:{OX_STRESS:.6,CO2:.4},rate:.12}),new O({inputs:{IRON:.3,CHELATOR:.4},outputs:{CHELATED_METAL:.6},rate:.08}),new O({inputs:{H2O:1,SALT:.4},outputs:{DEHYDRATION_SIGNAL:.6},rate:.1}),new O({inputs:{PH:.1,PH_ACID:.5},outputs:{PH_SHIFT:.5},rate:.1}),new O({inputs:{PH:.1,PH_BASE:.5},outputs:{PH_SHIFT:.5},rate:.1}),new O({inputs:{PH_SHIFT:.5,PH_BUFFER:.5},outputs:{},rate:.6}),new O({inputs:{OXIDIZER:.4,PH_BUFFER:.4},outputs:{OX_STRESS:.2},rate:.2})],re=[new O({inputs:{SER:.2,DOPA:.2},outputs:{SOCIAL_BOND:.4},rate:.08,condition:At("trust",.5)})],dt={REACTIONS_WORLD:oe,REACTIONS_BODY:yt,REACTIONS_SOCIAL:re};function ht(s){return[...s.REACTIONS_WORLD,...s.REACTIONS_BODY,...s.REACTIONS_SOCIAL]}[...yt];function ae(s){var t,e,i;return s.chemistry||(s.chemistry={body:{GLU:.5,H2O:.5,O2:.5,TEMP:.5,PH:.5},stomach:{},blood:{}}),(t=s.chemistry).body??(t.body={GLU:.5,H2O:.5,O2:.5,TEMP:.5,PH:.5}),(e=s.chemistry).stomach??(e.stomach={}),(i=s.chemistry).blood??(i.blood={}),s.chemistry}function ce(s,t,e){const i=ae(s),n={name:s.name,body:i.body,stomach:i.stomach,blood:i.blood};Lt(n,t,e),i.body=n.body,i.stomach=n.stomach??i.stomach,i.blood=n.blood??i.blood;const o=ft(i.body);return i.lastMacro=o,o}const k=.05;function $t(s){return Object.entries(s).filter(([,t])=>t>nt)}function bt(s){const t={};for(const[n,o]of $t(s))t[n]=o;const e=se(t);if(e<=nt)return{};const i={};for(const[n,o]of Object.entries(t))i[n]=o/e;return i}function gt(s){const t=bt(s),e=Object.entries(t).sort(([i],[n])=>i.localeCompare(n)).map(([i,n])=>`${i}:${(Math.round(n*1e3)/1e3).toFixed(3)}`);return e.length?e.join("|"):"empty"}function $(s,t){return $t(s).some(t)}function R(s,t){const e=bt(s);return t.reduce((i,n)=>i+(e[n]??0),0)}function le(s){const t=bt(s),e=[],i=$(t,([b,x])=>b.startsWith("ORE_")&&x>k),n=$(t,([b,x])=>["IRON","FE","CU","SN","AU"].includes(b)&&x>k),o=R(t,["FIBER"]),r=R(t,["RESIN"]),a=r>.1||o>.25&&r>.05,d=o>k,c=!i&&$(t,([b,x])=>["SILICA","MINERAL_DUST"].includes(b)&&x>k),l=R(t,["H2O"]),h=$(t,([b,x])=>["GLU","FRUCT","UMAMI","FAT","PROTEIN"].includes(b)&&x>k),u=l>.2,m=$(t,([b,x])=>["CARBON","COAL","ORE_COAL"].includes(b)&&x>k),f=$(t,([b,x])=>["OXIDIZER","PH_ACID","PH_BASE","CHELATOR"].includes(b)&&x>k),y=$(t,([b,x])=>b==="PH_BUFFER"&&x>k),w=t.FORGED??0,P=t.REFINED??0;i&&e.push("ore"),n&&e.push("metal"),a?e.push("wood"):d&&e.push("fiber"),c&&e.push("stone"),h&&e.push("food"),u&&e.push("drink"),m&&e.push("fuel"),f&&e.push("reactive"),y&&e.push("balancing"),(h||a)&&e.push("organic"),(i||c||n)&&e.push("inorganic"),w>k&&(e.push("forged"),e.includes("tool")||e.push("tool")),P>k&&(e.push("refined"),e.includes("material")||e.push("material"));const E=R(t,["GLU","FRUCT","FAT","PROTEIN"]),C=R(t,["AMARGO"]),v=R(t,["UMAMI"]),I=R(t,["SILICA","MINERAL_DUST","SALT","SLAG"]),X=R(t,["IRON","FE","CU","SN","AU","ORE_FE","ORE_CU","ORE_SN","ORE_AU","ORE_COAL"]),N=R(t,["OXIDIZER"]),B=R(t,["PH_ACID"]),J=R(t,["PH_BASE"]),ot=R(t,["CHELATOR"]),G=R(t,["PH_BUFFER"]),rt=R(t,["SALT"]),H=N+B+J+ot+rt,A={hydration:l,calories:E,bitterness:C,umami:v,mineralness:I,metalness:X,oxidizingPower:N,acidityPotential:B,basicityPotential:J,chelatingPower:ot,bufferingPower:G,osmoticLoad:rt,reactivity:H},Y=Object.entries(t).filter(([b])=>b.startsWith("ORE_")),vt=Y.length?Y.reduce((b,x)=>x[1]>b[1]?x:b)[0]:void 0,Ft=["FE","IRON","CU","SN","AU","ORE_FE","ORE_CU","ORE_SN","ORE_AU"],at=Object.entries(t).filter(([b])=>Ft.includes(b)).reduce((b,x)=>!b||x[1]>b[1]?x:b,null),q=at==null?void 0:at[0],Bt={ORE_FE:"Iron Ore",ORE_CU:"Copper Ore",ORE_SN:"Tin Ore",ORE_AU:"Gold Ore"},It={FE:"Iron",IRON:"Iron",CU:"Copper",SN:"Tin",AU:"Gold",ORE_FE:"Iron",ORE_CU:"Copper",ORE_SN:"Tin",ORE_AU:"Gold"};let M="Material";if(w>k&&(e.includes("metal")||e.includes("ore")))M=`${q?It[q]??"Metal":"Metal"} Tool`;else if(P>k&&(e.includes("ore")||e.includes("metal"))){const b=q?It[q]??"Metal":"Metal";M=q?`${b} Ingot`:"Refined Metal"}else e.includes("ore")?M=vt?Bt[vt]??"Ore":"Ore":e.includes("wood")?M="Wood":e.includes("stone")?M="Stone":e.includes("drink")?M=A.hydration>.7&&(t.H2O??0)>.7?"Water":"Drink":e.includes("food")?M="Food":e.includes("fuel")&&(M="Fuel");const D=[];A.mineralness>.35&&e.includes("drink")&&D.push("brackish"),A.mineralness>.35&&(e.includes("ore")||e.includes("metal"))&&D.push("impure"),A.calories>.45&&e.includes("food")&&D.push("nutritious"),A.reactivity>.35&&D.push("reactive");const Ht=D.length?`${M} (${D.join(", ")})`:M;return{tags:e,traits:A,canonicalName:M,displayName:Ht,signature:gt(s)}}function Rt(s){const t=le(s.mix);return{...s,...t,name:t.displayName}}class de{constructor(t){p(this,"items",new Map);p(this,"counter",0);t==null||t.forEach(e=>{const i=Rt(e);this.items.set(i.id,{...i,mix:{...i.mix}})})}register(t,e,i){const n=Rt({id:t,name:e,mix:i});return this.items.set(t,{...n,mix:{...n.mix}}),t}spawnFromMix(t,e){this.counter+=1;const i=`${t.toLowerCase().replace(/\s+/g,"-")}-${this.counter}`;return this.register(i,t,e)}getItem(t){const e=this.items.get(t);return e?{...e,mix:{...e.mix}}:void 0}getMix(t){const e=this.items.get(t);return e?{...e.mix}:void 0}mergeItemMix(t,e){const i=this.items.get(t);i&&(i.mix=Q(i.mix,e))}list(){return Array.from(this.items.values()).map(t=>({...t,mix:{...t.mix}}))}}function he(){const s=[{id:"berry-red",name:"Red Berry",mix:{GLU:.6,FRUCT:.4,DOCE:.2,H2O:.5}},{id:"ore-iron",name:"Iron Ore",mix:{ORE_FE:1,MINERAL_DUST:.1}},{id:"ore-copper",name:"Copper Ore",mix:{ORE_CU:1,MINERAL_DUST:.1}},{id:"water-flask",name:"Canteen",mix:{H2O:1}},{id:"raw-wood",name:"Wood",mix:{FIBER:.6,RESIN:.3,H2O:.2}},{id:"raw-stone",name:"Stone",mix:{SILICA:.5,MINERAL_DUST:.4}},{id:"raw-coal",name:"Coal",mix:{CARBON:.5,ORE_COAL:.5,COAL:.3}},{id:"raw-salt",name:"Salt",mix:{SALT:.8}},{id:"raw-water",name:"Water",mix:{H2O:1}},{id:"raw-wool",name:"Raw Wool",mix:{FIBER:.7,PROTEIN:.2,H2O:.1}},{id:"raw-cotton",name:"Cotton Bale",mix:{FIBER:.8,H2O:.15}},{id:"raw-leather",name:"Raw Leather",mix:{PROTEIN:.6,FAT:.2,FIBER:.1,H2O:.1}},{id:"raw-herb",name:"Aromatic Herbs",mix:{GLU:.2,H2O:.4,PH_BUFFER:.1,UMAMI:.1}},{id:"raw-grain",name:"Grains",mix:{GLU:.5,FIBER:.3,H2O:.1}}];return new de(s)}function ue(s,t){if(s.length===0)return{};const e=t&&t.length===s.length?t:new Array(s.length).fill(1),i=e.reduce((n,o)=>n+Math.max(o,0),0)||s.length;return s.reduce((n,o,r)=>{const a=Math.max(e[r]??1,0)/i,d=mt(o.mix,a);return Q(n,d)},{})}function me(s){switch(s){case"forge":return{temperature:.9,tags:{heat:1},steps:8,dt:.8};case"cook":return{temperature:.65,tags:{heat:.6,wet:.2},steps:6,dt:.6};case"brew":return{temperature:.55,tags:{wet:1},steps:10,dt:.5};case"refine":return{temperature:.75,tags:{heat:.8,oxidize:.5},steps:7,dt:.7};default:return{}}}function fe(s,t,e,i,n,o,r){const a=ue(i,r);n==="forge"?j(a,"FORGED",.1):n==="refine"&&j(a,"REFINED",.1);const d=me(n),c=typeof(s==null?void 0:s.choice)=="function"&&"next"in s?s.next():Math.random(),l=Nt(a,{...d,tags:{...d.tags??{},variation:c}},e),h=o||`${n} craft`;return t.spawnFromMix(h,l)}function ge(s,t,e,i=5,n=.5){const o=ft(s),r={body:{...s},stomach:{...t}};for(let h=0;h<i;h++)Lt(r,e,n);const a=ft(r.body),d=["ATP","H2O","O2","GLU","PH","TEMP"],c={};for(const h of d)c[h]=(r.body[h]??0)-(s[h]??0);const l=[];return c.H2O>.05&&l.push("positive hydration"),c.H2O<-.05&&l.push("reduced hydration"),c.ATP>.05&&l.push("increased potential energy"),c.O2<-.05&&l.push("oxygen consumed"),c.PH<-.05&&l.push("acidifying tendency"),c.PH>.05&&l.push("alkalizing tendency"),{before:o,after:a,essentialDelta:c,notes:l}}function z(s,t,e){return(s[t]??0)>=e}function tt(s,t,e){e<=0||(s[t]=(s[t]??0)+e)}function F(s,t,e){if(!z(s,t,e))return!1;const i=(s[t]??0)-e;return i<=0?delete s[t]:s[t]=i,!0}function et(s,t,e,i){const n=t.list().filter(o=>{var r;return((r=o.tags)==null?void 0:r.includes(e))&&z(s,o.id,1)});return n.length===0?null:i.choice(n)}function L(s,t){return s[t]||(s[t]={}),s[t]}const Ot=1200,ut=2e3,Tt=500,pe={Blacksmith:["forge"],Artisan:["craft"],Tailor:["tailor"],Builder:["build"],Weaver:["weave"],Lumberjack:["harvest_wood"],Farmer:["grow_food"],Rancher:["raise_animals"],Fisher:["fish"],Hunter:["hunt"],Miner:["mine_ore"],Alchemist:["alchemy"],Herbalist:["alchemy"],Merchant:["trade"],Guard:["security"],Soldier:["security"],Aristocrat:["influence"],Politician:["influence"],Patron:["influence"]};function kt(s){return Array.from(new Set(s))}function ye(s){return pe[s]??[]}class be{constructor(t=Date.now()){p(this,"seed");this.seed=t}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}nextInt(t,e){return Math.floor(this.next()*(e-t+1))+t}choice(t){if(t.length===0)throw new Error("Cannot choose from empty array");return t[Math.floor(this.next()*t.length)]}}class ve{constructor(){p(this,"state");p(this,"listeners",new Set);p(this,"lastActionTick",0);p(this,"random");p(this,"indices");p(this,"initialEconomyGold",0);p(this,"itemRegistry");p(this,"timeSinceLastItemSynthesis",0);p(this,"lastMarketFluctuationDay",-1);p(this,"stockpilesByPoi");this.random=new be,this.itemRegistry=he(),this.stockpilesByPoi={},this.state=this.createInitialState(),this.initializeStockpiles(),this.indices=new Wt(this.state.worldMap.width),this.rebuildIndices(),Yt(this.state,5e3,1e4,this.random),this.initialEconomyGold=pt(this.state),console.log(`[GameEngine] Economy initialized with ${this.initialEconomyGold} total gold`)}createInitialState(){const t={name:"Guild Master",gold:100,level:1,experience:0},e=[{id:"quest-1",title:"Welcome to the Guild",description:"Complete your first quest to begin your journey.",reward:50,completed:!1},{id:"quest-2",title:"Gather Resources",description:"Collect resources to expand your guild.",reward:100,completed:!1}],i=new Gt(64,64);i.generateCity();const n=this.generateFamilies(20),o=this.generateInitialNPCs(100,i,n);return{player:t,quests:e,currentTime:0,day:1,timeOfDaySec:0,simRunning:!1,reportLog:[{timestamp:0,message:"Welcome to ProjectGM. The guild is ready to begin."}],families:n,npcs:o,worldMap:i,cityTreasury:0,relations:new Map,guildTreasury:0}}initializeStockpiles(){const t=this.itemRegistry.list(),e={wood:30,stone:30,ore:18,fuel:16,drink:40,food:34,organic:14,fiber:20,balancing:8,metal:12},i={"guild-hall":{...e},market:{...e,fiber:26},mine:{...e,ore:40,metal:20,stone:42,fuel:24},forest:{...e,wood:55,drink:30,organic:40,fiber:35},tavern:{...e,food:50,drink:60,wood:12,stone:10,fiber:18}};for(const[n,o]of Object.entries(i)){const r=L(this.stockpilesByPoi,n);for(const a of t)if(a.tags)for(const d of a.tags){const c=o[d];c&&tt(r,a.id,c)}}}generateFamilies(t){const e=["Silva","Cavalcanti","Lins","Holanda","Barros","Melo","Albuquerque","Santos","Oliveira","Souza","Costa","Ferreira","Rodrigues","Nascimento","Lima"],i=[];for(let n=0;n<t;n++){const o=this.random.next();let r="commoner";o>.9?r="noble":o>.75?r="merchant":o>.6&&(r="artisan"),i.push({id:`fam-${n}`,surname:this.random.choice(e),caste:r})}return i}generateStats(t){const e=()=>this.random.nextInt(3,10),i={strength:e(),vitality:e(),dexterity:e(),wisdom:e(),intelligence:e(),charisma:e()};switch(t){case"noble":i.charisma+=3,i.intelligence+=2;break;case"artisan":i.dexterity+=3,i.wisdom+=1;break;case"commoner":i.strength+=2,i.vitality+=2;break;case"merchant":i.charisma+=2,i.wisdom+=2;break}return i}generateInitialNPCs(t,e,i){const n=["John","Mary","Peter","Anna","Charles","Beatrice","Luke","Julia","Raphael","Camille","Fernando","Isabella","Gabriel","Larissa","Matthew","Sophie","Bruno","Amanda","Diego","Leticia"],o=["Brave","Cautious","Greedy","Generous","Skilled","Lucky","Hardworking","Lazy","Clever","Naive"],r=[];for(let a=0;a<t;a++){const d=this.random.choice(n),c=this.random.choice(i),l=this.generateStats(c.caste),h=c.caste==="noble"?50:0;let u="Unemployed";c.caste==="noble"?u=this.random.choice(["Aristocrat","Politician","Patron"]):c.caste==="artisan"||l.dexterity>7?u=this.random.choice(["Blacksmith","Artisan","Tailor","Builder","Weaver"]):c.caste==="merchant"||l.charisma>7?u="Merchant":l.strength>7?u=this.random.choice(["Guard","Soldier","Lumberjack"]):l.wisdom>7?u=this.random.choice(["Alchemist","Herbalist"]):l.dexterity>7?u=this.random.choice(["Hunter","Lumberjack"]):u=this.random.choice(["Farmer","Rancher","Fisher","Miner"]);let m=0;switch(c.caste){case"noble":m=this.random.nextInt(300,800);break;case"merchant":m=this.random.nextInt(100,400);break;case"artisan":m=this.random.nextInt(50,150);break;default:m=this.random.nextInt(5,50);break}const f=[],y=this.random.nextInt(1,3);for(let C=0;C<y;C++){const v=this.random.choice(o);f.includes(v)||f.push(v)}let w=this.random.nextInt(0,e.width-1),P=this.random.nextInt(0,e.height-1),E=0;for(;!e.isWalkable(w,P)&&E<100;)w=this.random.nextInt(0,e.width-1),P=this.random.nextInt(0,e.height-1),E++;e.isWalkable(w,P)||(w=0,P=0),r.push({id:`npc-${a+1}`,name:`${d} ${c.surname}`,familyId:c.id,caste:c.caste,reputation:h,stats:l,talents:kt([...ye(u),...l.strength>8?["harvest_wood"]:[],...l.wisdom>8?["alchemy"]:[],...l.dexterity>8?["craft"]:[]]),pos:{x:w,y:P},money:m,job:u,traits:f,needs:{hunger:this.random.nextInt(40,60),social:this.random.nextInt(40,60),fun:this.random.nextInt(40,60)}})}return r}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t(this.state))}getState(){return{...this.state}}rebuildIndices(){this.indices.clear();for(const e of this.state.npcs)this.indices.addEntityToCell(e.id,e.pos);for(const e of this.state.npcs)if(e.inventory)for(const[i,n]of e.inventory.entries())n>0&&this.indices.addSeller(e.id,i);const t=this.indices.getDebugInfo();console.log("[Phase 2] Indices rebuilt:",t)}validateIndices(){const t=Qt(this.state.npcs,this.indices,this.state.worldMap);Xt(t)}getEntitiesNearPosition(t,e,i){const n=this.indices.getEntitiesInRadius({x:t,y:e},i);return this.state.npcs.filter(o=>n.has(o.id))}getSellersOfItem(t){const e=this.indices.getSellersOfItem(t);return this.state.npcs.filter(i=>e.has(i.id))}start(){this.state.simRunning||(this.state.simRunning=!0,this.addReportLog("Simulation started."),this.notify())}stop(){this.state.simRunning&&(this.state.simRunning=!1,this.addReportLog("Simulation paused."),this.notify())}toggle(){this.state.simRunning?this.stop():this.start()}addReportLog(t){this.state.reportLog.push({timestamp:this.state.currentTime,message:t}),this.state.reportLog.length>Tt&&(this.state.reportLog=this.state.reportLog.slice(-Tt)),this.notify()}executeWorldActions(){const t=this.random.nextInt(1,8);for(let e=0;e<t;e++)this.executeRandomAction()}executeRandomAction(){switch(this.random.nextInt(0,5)){case 0:this.actionNPCMovement();break;case 1:this.actionNPCTrade();break;case 2:this.actionNPCWork();break;case 3:this.actionNPCEat();break;case 4:this.random.next()<.5?this.actionRandomEncounter():this.actionGuildEvent();break;case 5:this.actionMarketFluctuation();break}}isNPCAtPOI(t,e){var o,r;const i=((o=e.footprint)==null?void 0:o.x)||1,n=((r=e.footprint)==null?void 0:r.y)||1;return t.pos.x>=e.pos.x&&t.pos.x<e.pos.x+i&&t.pos.y>=e.pos.y&&t.pos.y<e.pos.y+n}getPOIForPosition(t){return this.state.worldMap.getPOIs().find(e=>{var o,r;const i=((o=e.footprint)==null?void 0:o.x)||1,n=((r=e.footprint)==null?void 0:r.y)||1;return t.x>=e.pos.x&&t.x<e.pos.x+i&&t.y>=e.pos.y&&t.y<e.pos.y+n})}resolveDefaultPoiId(){var t,e,i;return((t=this.state.worldMap.getPOI("market"))==null?void 0:t.id)||((e=this.state.worldMap.getPOI("guild-hall"))==null?void 0:e.id)||((i=this.state.worldMap.getPOIs()[0])==null?void 0:i.id)||"guild-hall"}getNpcPoi(t){return this.getPOIForPosition(t.pos)}getNpcStockpile(t){const e=this.getNpcPoi(t),i=(e==null?void 0:e.id)??this.resolveDefaultPoiId();return{stockpile:L(this.stockpilesByPoi,i),poiId:i}}actionNPCMovement(){if(this.state.npcs.length===0)return;const t=this.random.choice(this.state.npcs);if(t.currentPath&&t.currentPath.length>0){const e=t.currentPath[0];if(!Ut(t.currentPath,this.state.worldMap)){t.currentPath=void 0;return}const i={x:t.pos.x,y:t.pos.y};if(t.pos={x:e.x,y:e.y},t.currentPath.shift(),this.indices.moveEntity(t.id,i,t.pos),t.currentPath.length===0&&t.targetPos){const o=this.state.worldMap.getPOIs().find(r=>r.pos.x===t.targetPos.x&&r.pos.y===t.targetPos.y);o&&this.addReportLog(`${t.name} arrived at ${o.name}.`),t.targetPos=void 0,t.currentPath=void 0}}else if(this.random.next()<.3){const e=this.state.worldMap.getPOIs(),i=this.random.choice(e);if(!this.isNPCAtPOI(t,i)){t.targetPos={x:i.pos.x,y:i.pos.y};const n=K(t.pos,t.targetPos,this.state.worldMap);n.length>0?t.currentPath=n:t.targetPos=void 0}}}actionNPCTrade(){var P,E,C;if(this.state.npcs.length<2)return;const t=this.state.worldMap.getPOI("market"),e=this.state.worldMap.getPOI("tavern"),i=t??e;if(!i)return;const n=this.random.choice(this.state.npcs);if(!this.isNPCAtPOI(n,i)){if(this.random.next()<.4&&!n.targetPos){n.targetPos={x:i.pos.x,y:i.pos.y};const v=K(n.pos,n.targetPos,this.state.worldMap);n.currentPath=v.length>0?v:void 0,n.currentPath||(n.targetPos=void 0)}return}const a=(((P=n.needs)==null?void 0:P.hunger)??50)<55?["food","drink"]:this.random.next()<.6?["tool"]:["material"],d=this.state.npcs.filter(v=>v.id!==n.id&&this.isNPCAtPOI(v,i));if(d.length===0)return;for(let v=0;v<6;v++){const I=this.random.choice(d),X=this.itemRegistry.list().filter(H=>{var A;return((A=H.tags)==null?void 0:A.some(Y=>a.includes(Y)))&&V(I,H.id,1)});if(X.length===0)continue;const N=this.random.choice(X),B=((E=N.tags)==null?void 0:E.find(H=>a.includes(H)))??a[0],J=i.id,G=Math.max(1,Math.round((B==="tool"?25:B==="material"?15:10)*this.getPriceMultiplier(J,B)));if(!(n.money<G||!U(this.state,n.id,I.id,G))){Z(I,N.id,1,this.indices),_(n,N.id,1,this.indices),this.addReportLog(`${n.name} bought ${N.name} from ${I.name} for ${G} coins.`),St(this.state,n.id,I.id,"trade"),T(n,"hunger",a.includes("food")||a.includes("drink")?8:2);return}}const c=i.id,l=L(this.stockpilesByPoi,c),h=a.map(v=>et(l,this.itemRegistry,v,this.random)).filter(v=>!!v);if(h.length===0)return;const u=this.random.choice(h),m=((C=u.tags)==null?void 0:C.find(v=>a.includes(v)))??a[0],y=Math.max(1,Math.round((m==="tool"?25:m==="material"?15:10)*this.getPriceMultiplier(c,m)));n.money<y||!U(this.state,n.id,"city",y)||(F(l,u.id,1),_(n,u.id,1,this.indices),this.addReportLog(`${n.name} purchased ${u.name} at ${i.name} for ${y} coins.`),T(n,"hunger",a.includes("food")||a.includes("drink")?6:1))}getCraftProfileForJob(t){switch(t){case"Blacksmith":return{requiredTalent:"forge",intent:this.random.next()>.6?"weapon":"tool",process:"forge",requiredTags:[["metal","ore"],["fuel"],["wood","organic","fiber"]],optionalTags:[["metal","ore"],["wood","organic"]]};case"Artisan":return{requiredTalent:"craft",intent:this.random.next()>.55?"tool":"material",process:"refine",requiredTags:[["wood","fiber","organic"],["wood","fiber","organic"],["stone","wood"]],optionalTags:[["fuel"],["organic","fiber"]]};case"Tailor":return{requiredTalent:"tailor",intent:"material",process:"cook",requiredTags:[["fiber"],["fiber","organic"]],optionalTags:[["organic","material"],["fiber"]]};case"Builder":return{requiredTalent:"build",intent:this.random.next()>.4?"material":"tool",process:"refine",requiredTags:[["stone"],["wood","organic"],["wood","fiber","organic"]],optionalTags:[["fuel"],["stone","wood"]]};case"Weaver":return{requiredTalent:"weave",intent:"material",process:"cook",requiredTags:[["fiber"],["fiber","organic"]],optionalTags:[["organic","fiber"]]};case"Lumberjack":return{requiredTalent:"harvest_wood",intent:"material",process:"refine",requiredTags:[["wood"],["wood","organic"]],optionalTags:[["fuel","wood"],["organic"]]};case"Farmer":return{requiredTalent:"grow_food",intent:"food",process:"cook",requiredTags:[["food","organic"],["drink"]],optionalTags:[["food","organic"],["drink","organic"]]};case"Rancher":return{requiredTalent:"raise_animals",intent:this.random.next()>.5?"food":"drink",process:this.random.next()>.4?"cook":"brew",requiredTags:[["food","organic"],["drink"],["fiber","organic"]],optionalTags:[["organic"],["fiber","organic"]]};case"Alchemist":case"Herbalist":return{requiredTalent:"alchemy",intent:this.random.next()>.5?"medicine":"drink",process:"brew",requiredTags:[["organic"],["balancing","drink","medicine","organic"]],optionalTags:[["drink","medicine","organic"],["balancing","organic"]]};case"Miner":return{requiredTalent:"mine_ore",intent:"material",process:"refine",requiredTags:[["ore","stone"],["stone"]],optionalTags:[["fuel"]]};case"Hunter":return{requiredTalent:"hunt",intent:this.random.next()>.4?"food":"material",process:"cook",requiredTags:[["organic"],["food","organic"]],optionalTags:[["fiber"],["drink","organic"]]};case"Fisher":return{requiredTalent:"fish",intent:"food",process:"cook",requiredTags:[["food","drink","organic"],["food","organic"]],optionalTags:[["drink","organic"]]};default:return null}}countSelection(t,e,i){return t.filter(n=>n.definition.id===e&&n.source===i).length}pickIngredient(t,e,i,n,o=!1){const r=this.itemRegistry.list(),a=o?[]:i.map(f=>f.definition.id),d=r.filter(f=>{var y;return((y=f.tags)==null?void 0:y.some(w=>e.includes(w)))&&!a.includes(f.id)}),l=e.includes("stone")&&!e.includes("ore")?d.filter(f=>{var y;return!((y=f.tags)!=null&&y.includes("ore"))}):d,h=l.length>0?l:d,u=h.filter(f=>V(t,f.id,1+this.countSelection(i,f.id,"inventory")));if(u.length>0)return{definition:this.random.choice(u),source:"inventory"};const m=h.filter(f=>z(n,f.id,1+this.countSelection(i,f.id,"stockpile")));return m.length>0?{definition:this.random.choice(m),source:"stockpile"}:null}acquireInputs(t,e,i=[],n){const o=[],r=n??this.getNpcStockpile(t).stockpile;for(const a of e){const d=this.pickIngredient(t,a,o,r);if(!d)return null;o.push(d)}for(const a of i){if(o.length>=3)break;const d=this.pickIngredient(t,a,o,r);d&&o.push(d)}if(o.length<2)for(const a of e){const d=this.pickIngredient(t,a,o,r,!0);if(d){o.push(d);break}}return o.length>=2?o:null}performGatheringJob(t,e,i){var u;const n={Miner:{sourcePoi:"mine",tags:[["ore","metal","stone","fuel"]],activity:"hauled resources from"},Lumberjack:{sourcePoi:"forest",tags:[["wood"]],activity:"felled timber in"},Farmer:{sourcePoi:"market",tags:[["food","organic"],["drink"]],activity:"collected produce at"},Rancher:{sourcePoi:"market",tags:[["fiber","food","organic"]],activity:"brought ranch goods from"},Fisher:{sourcePoi:"tavern",tags:[["food","drink","organic"]],activity:"hauled a catch from"},Hunter:{sourcePoi:"forest",tags:[["organic","food","fiber"]],activity:"returned with game from"}},o=t.job?n[t.job]:void 0;if(!o)return!1;const r=L(this.stockpilesByPoi,o.sourcePoi),a=((u=this.state.worldMap.getPOI(o.sourcePoi))==null?void 0:u.name)??o.sourcePoi,d=kt(o.tags.flat());let c=null;const l=new Set;for(;l.size<d.length&&!c;){const m=this.random.choice(d.filter(f=>!l.has(f)));l.add(m),c=et(r,this.itemRegistry,m,this.random)}if(!c)return!1;F(r,c.id,1),tt(e,c.id,1);const h=c.displayName??c.name??c.id;return this.addReportLog(`${t.name} ${o.activity} ${a} and stocked ${h} at ${i}.`),W(t,"hunger",-5),W(t,"fun",-2),!0}collectFromStockpile(t,e,i,n){const o=e.flat(),r=this.random.choice(o),a=et(i,this.itemRegistry,r,this.random);a&&(F(i,a.id,1),_(t,a.id,1,this.indices),this.addReportLog(`${t.name} collected ${a.displayName??a.name} from the local stockpile (${n}).`))}matchItemBySignature(t,e,i,n){const o=this.itemRegistry.list().filter(d=>d.signature===e||gt(d.mix)===e),r=o.filter(d=>V(t,d.id,1+this.countSelection(i,d.id,"inventory")));if(r.length>0)return{definition:this.random.choice(r),source:"inventory"};const a=o.filter(d=>z(n,d.id,1+this.countSelection(i,d.id,"stockpile")));return a.length>0?{definition:this.random.choice(a),source:"stockpile"}:null}pickLearnedRecipe(t,e,i,n){const o=(t.learnedRecipes??[]).filter(r=>r.intent===e&&r.process===i).sort((r,a)=>a.score-r.score);for(const r of o){const a=[];let d=!0;for(const c of r.inputSignatures){const l=this.matchItemBySignature(t,c,a,n);if(!l){d=!1;break}a.push(l)}if(d&&a.length>=2)return{inputs:a,weights:r.weights}}return null}rememberRecipe(t,e,i,n,o,r){const a=n.map(c=>c.signature??gt(c.mix));t.learnedRecipes??(t.learnedRecipes=[]);const d=t.learnedRecipes.find(c=>c.intent===e&&c.process===i&&c.inputSignatures.length===a.length&&c.inputSignatures.every((l,h)=>l===a[h]));if(d){r>d.score&&(d.score=r,d.weights=o??d.weights);return}t.learnedRecipes.push({intent:e,process:i,inputSignatures:a,weights:o,score:r})}chooseWeights(t,e){const i=[];for(let n=0;n<t;n++){const o=n<e?.5+.4*this.random.next():.1+.4*this.random.next();i.push(Number(o.toFixed(3)))}return i}scoreResult(t,e,i){if(t==="food"||t==="drink"||t==="medicine"){const c=ge(e,i.mix,ht(dt),20,1),l=c.after.energy-c.before.energy,h=c.before.hungerSignal-c.after.hungerSignal,u=c.before.thirstSignal-c.after.thirstSignal,m=Math.max(0,-c.essentialDelta.ATP)+Math.max(0,-c.essentialDelta.H2O)+Math.max(0,Math.abs(c.essentialDelta.PH)-.05)+Math.max(0,c.essentialDelta.O2<-.05?-c.essentialDelta.O2:0);return l*2+h+u-m}const n=i.traits??{},o=(i.mix.SLAG??0)+(i.mix.MINERAL_DUST??0),r=1-(n.reactivity??0),a=n.metalness??0,d=n.mineralness??0;return t==="weapon"||t==="tool"?1.2*a+.8*r-.5*o:d+.5*r-.4*o}actionNPCWork(){var E,C,v;if(this.state.npcs.length===0)return;const t=this.random.choice(this.state.npcs);let e=this.getCraftProfileForJob(t.job);if(e!=null&&e.requiredTalent&&!((E=t.talents)!=null&&E.includes(e.requiredTalent))||!e)return;let i;t.job==="Miner"?i=this.state.worldMap.getPOI("mine"):t.job==="Hunter"||t.job==="Fisher"||t.job==="Farmer"||t.job==="Rancher"||t.job==="Lumberjack"?i=this.state.worldMap.getPOI("forest"):t.job==="Merchant"&&(i=this.state.worldMap.getPOI("market"));const n=this.getNpcPoi(t)??this.state.worldMap.getPOI("market"),o=((C=i??n)==null?void 0:C.id)??this.resolveDefaultPoiId(),r=L(this.stockpilesByPoi,o),a=this.computeLocalScarcity(o,"food"),d=this.computeLocalScarcity(o,"drink"),c=this.computeLocalScarcity(o,"tool"),l=this.computeLocalScarcity(o,"material");if(e.intent==="weapon"&&c>.6?e={...e,intent:"tool"}:e.intent==="tool"||e.intent==="material"?c>l+.2?e={...e,intent:"tool",process:e.process}:l>c+.2&&(e={...e,intent:"material",process:e.process}):e.intent==="food"&&d>.65&&d>a&&(e={...e,intent:"drink",process:"brew",requiredTags:[["drink"]]}),i&&!this.isNPCAtPOI(t,i)){if(!t.targetPos){t.targetPos={x:i.pos.x,y:i.pos.y};const I=K(t.pos,t.targetPos,this.state.worldMap);I.length>0?t.currentPath=I:t.targetPos=void 0}return}const h=this.pickLearnedRecipe(t,e.intent,e.process,r);let u=(h==null?void 0:h.inputs)??null,m=h==null?void 0:h.weights;if(u||(u=this.acquireInputs(t,e.requiredTags,e.optionalTags??[],r),u&&(m=this.chooseWeights(u.length,e.requiredTags.length))),!u){if(this.performGatheringJob(t,r,o))return;this.collectFromStockpile(t,e.requiredTags,r,o);return}const f=u.map(I=>I.definition);if(f.length<2){if(this.performGatheringJob(t,r,o))return;this.collectFromStockpile(t,e.requiredTags,r,o);return}for(const I of u)I.source==="inventory"?Z(t,I.definition.id,1,this.indices):F(r,I.definition.id,1);const y=fe(this.random,this.itemRegistry,ht(dt),f,e.process,e.process==="forge"?"Forge product":e.process==="refine"?"Refined material":`${e.intent} ${e.process}`,m);tt(r,y,1),this.random.next()>.7&&(F(r,y,1),_(t,y,1,this.indices));const P=this.itemRegistry.getItem(y);if(P){const I=this.scoreResult(e.intent,((v=t.chemistry)==null?void 0:v.body)??{},P);I>.2&&this.rememberRecipe(t,e.intent,e.process,f,m,I),this.addReportLog(`${t.name} worked as a ${t.job} and produced ${P.displayName??P.name}, storing it at ${o}.`)}W(t,"hunger",-5),W(t,"fun",-2)}actionNPCEat(){var a,d;if(this.state.npcs.length===0)return;const t=this.random.choice(this.state.npcs),e=this.itemRegistry.list().filter(c=>this.isEdible(c));let i=!1;const{stockpile:n,poiId:o}=this.getNpcStockpile(t),r=e.find(c=>V(t,c.id,1));if(r){const l=((a=r.tags)==null?void 0:a.includes("drink"))?"drank":"ate";Z(t,r.id,1,this.indices),T(t,"hunger",30),this.addReportLog(`${t.name} ${l} ${this.describeItem(r.id)}.`),i=!0}else{const c=e.filter(l=>z(n,l.id,1));if(c.length>0){const l=this.random.choice(c),u=((d=l.tags)==null?void 0:d.includes("drink"))?"drank":"ate";F(n,l.id,1),T(t,"hunger",25),this.addReportLog(`${t.name} ${u} ${this.describeItem(l.id)} at ${o}.`),i=!0}else{const l=this.state.worldMap.getPOI("market");if(l&&this.isNPCAtPOI(t,l)){const h=this.random.next()>.5?"food":"drink",u=this.getPriceMultiplier(o,h),m=Math.round(this.random.nextInt(5,15)*u);if(U(this.state,t.id,"city",m)){const y=this.ensureProceduralItemId("food",w=>e.includes(w));_(t,y,1,this.indices),this.addReportLog(`${t.name} bought ${this.describeItem(y)} for ${m} coins.`),Z(t,y,1,this.indices),T(t,"hunger",25),i=!0}}else if(l&&!t.targetPos){t.targetPos={x:l.pos.x,y:l.pos.y};const h=K(t.pos,t.targetPos,this.state.worldMap);h.length>0?t.currentPath=h:t.targetPos=void 0}}}i||this.addReportLog(`${t.name} could not find food or drink.`)}actionGuildEvent(){const t=["A new adventurer arrived at the guild.","The guild received an anonymous donation.","A rumor of distant treasures spreads through the tavern.","The guild council met to discuss new contracts.","Local merchants report increased sales."],e=this.random.choice(t);this.addReportLog(e)}actionRandomEncounter(){if(this.state.npcs.length===0)return;const t=this.random.choice(this.state.npcs),e=this.state.worldMap.getPOI("tavern");if(e&&this.isNPCAtPOI(t,e)){const n=this.getEntitiesNearPosition(t.pos.x,t.pos.y,3).filter(o=>o.id!==t.id);if(n.length>0){const o=this.random.choice(n);St(this.state,t.id,o.id,"chat"),this.addReportLog(`${t.name} chatted with ${o.name} at the tavern.`),T(t,"social",10),T(t,"fun",8),T(o,"social",10),T(o,"fun",8)}else{const o=[`${t.name} joined a party at the tavern.`,`${t.name} heard tales of distant lands.`],r=this.random.choice(o);this.addReportLog(r),T(t,"social",5),T(t,"fun",10)}}else{const i=[`${t.name} found an old coin along the road.`,`${t.name} helped a lost traveler.`,`${t.name} witnessed a duel in the plaza.`],n=this.random.choice(i);this.addReportLog(n),T(t,"fun",3)}}computeTagQuantity(t,e){var o;const i=L(this.stockpilesByPoi,t);let n=0;for(const[r,a]of Object.entries(i)){const d=this.itemRegistry.getItem(r);(o=d==null?void 0:d.tags)!=null&&o.includes(e)&&(n+=a)}return n}computeLocalScarcity(t,e){const o=1-this.computeTagQuantity(t,e)/50;return Math.max(0,Math.min(1,o))}getPriceMultiplier(t,e){return 1+1.5*this.computeLocalScarcity(t,e)}actionMarketFluctuation(){var r;if(this.lastMarketFluctuationDay===this.state.day)return;this.lastMarketFluctuationDay=this.state.day;const t=((r=this.state.worldMap.getPOI("market"))==null?void 0:r.id)??this.resolveDefaultPoiId(),e=this.computeLocalScarcity(t,"food"),i=this.computeLocalScarcity(t,"drink"),n=this.computeLocalScarcity(t,"tool"),o=this.computeLocalScarcity(t,"material");if(e>.7)this.addReportLog("Food scarcity rumors impact the local market.");else if(e<.2)this.addReportLog("An abundance of food pushed prices down this week.");else if(i>.7)this.addReportLog("Water and drinks are scarce and prices have risen.");else if(n>.7)this.addReportLog("Tool demand increased while local stocks remain low.");else if(o<.2)this.addReportLog("Refined materials are oversupplied; prices are falling.");else{const a=["Food prices ticked up slightly.","The weapons market is hot this week.","Potions are cheaper due to oversupply.","Demand for tools increased.","Scarcity rumors ripple through the market."],d=this.random.choice(a);this.addReportLog(d)}this.actionTraderFlow()}actionTraderFlow(){const t=this.state.worldMap.getPOIs();if(t.length<2)return;const e=["food","drink","tool","material"];let i=null;for(const c of e){let l=null,h=null;for(const u of t){const m=this.computeLocalScarcity(u.id,c);(!l||m<l.scarcity)&&(l={poi:u,scarcity:m}),(!h||m>h.scarcity)&&(h={poi:u,scarcity:m})}if(l&&h){const u=h.scarcity-l.scarcity;u>.3&&this.computeTagQuantity(l.poi.id,c)>0&&(!i||u>i.scarcityDelta)&&(i={tag:c,from:l.poi,to:h.poi,scarcityDelta:u})}}if(!i)return;const n=L(this.stockpilesByPoi,i.from.id),o=L(this.stockpilesByPoi,i.to.id),r=et(n,this.itemRegistry,i.tag,this.random);if(!r)return;const a=Math.max(1,Math.min(3,Math.floor((this.computeTagQuantity(i.from.id,i.tag)||1)/4)));F(n,r.id,a)&&(tt(o,r.id,a),this.addReportLog(`A trader carried ${a}x ${r.displayName??r.name} from ${i.from.name} to ${i.to.name}.`))}completeQuest(t){const e=this.state.quests.find(o=>o.id===t);if(!e||e.completed)return!1;e.completed=!0;let i=!1;this.state.guildTreasury!==void 0&&this.state.guildTreasury>=e.reward?i=U(this.state,"guild","player",e.reward):i=U(this.state,"city","player",e.reward),i||(this.state.player.gold+=e.reward,console.warn("[Economy] Quest reward transfer failed, adding gold directly")),this.state.player.experience+=e.reward;const n=this.state.player.level*100;return this.state.player.experience>=n&&(this.state.player.level++,this.state.player.experience-=n),this.addReportLog(`Quest "${e.title}" completed! Reward: ${e.reward} coins.`),this.notify(),!0}update(t){if(this.state.currentTime+=t,this.state.simRunning){const e=Math.floor(this.state.timeOfDaySec),i=t/1e3;for(this.state.timeOfDaySec+=i;this.state.timeOfDaySec>=Ot;)this.state.timeOfDaySec-=Ot,this.state.day++,this.addReportLog(`--- Day ${this.state.day} ---`);if(Math.floor(this.state.timeOfDaySec)!==e&&this.notify(),this.state.currentTime-this.lastActionTick>=ut){this.lastActionTick=this.state.currentTime,this.applyChemistryTick(ut/1e3),this.maybeSynthesizeProceduralItem(ut),this.executeWorldActions();const o=Jt(this.state,this.initialEconomyGold);o.valid||console.error("[Economy] Invariant violation detected!",o)}}}addGold(t){this.state.player.gold+=t,this.notify()}applyChemistryTick(t){for(const e of this.state.npcs){const i=ce(e,yt,t);Zt(e,i)}}pickCatalogItem(t){const e=this.itemRegistry.list(),i=t?e.filter(t):e;if(i.length!==0)return this.random.choice(i)}synthesizeProceduralItem(t){const e=this.pickCatalogItem();if(!e)return null;const i={O2:.5+.5*this.random.next(),H2O:.2+.4*this.random.next(),TEMP:.5+.5*this.random.next()},n=Nt(Q(e.mix,i),{temperature:i.TEMP,tags:{rainfall:i.H2O,trust:this.random.next()},steps:4,dt:.5},ht(dt)),r=(t?`Procedural ${t}`:"Procedural Item").trim();return this.itemRegistry.spawnFromMix(r,n)}ensureProceduralItemId(t,e){const i=this.pickCatalogItem(e);if(i)return i.id;const n=this.synthesizeProceduralItem(t);if(n)return n;const o={GLU:.1+.4*this.random.next(),FRUCT:.05*this.random.next(),H2O:.2+.6*this.random.next()};return this.itemRegistry.spawnFromMix(`${t} fallback`,o)}isEdible(t){if(!t.tags)return!1;const e=t.tags.some(n=>n==="food"||n==="drink"),i=t.tags.includes("ore")||t.tags.includes("metal")||t.tags.includes("stone");return e&&!i}describeItem(t){var e;return((e=this.itemRegistry.getItem(t))==null?void 0:e.name)??t}maybeSynthesizeProceduralItem(t){if(this.timeSinceLastItemSynthesis+=t,this.timeSinceLastItemSynthesis<1e4||this.state.npcs.length===0)return;this.timeSinceLastItemSynthesis=0;const e=this.synthesizeProceduralItem("item");if(!e)return;const i=this.random.choice(this.state.npcs);_(i,e,1,this.indices),this.addReportLog(`${i.name} acquired a new procedural item: ${this.describeItem(e)}.`)}getItemMix(t){return this.itemRegistry.getMix(t)}spawnItemFromMix(t,e){return this.itemRegistry.spawnFromMix(t,e)}}class Ie{constructor(t){p(this,"rootElement");p(this,"questCompleteHandler");p(this,"lastRenderTime",0);p(this,"renderThrottleMs",250);p(this,"pendingRender",!1);p(this,"engineToggle");p(this,"mapWindow",null);p(this,"latestAsciiMap","");this.rootElement=t,this.rootElement.addEventListener("click",e=>{var n,o;const i=e.target;i instanceof HTMLButtonElement&&(i.dataset.questId?(n=this.questCompleteHandler)==null||n.call(this,i.dataset.questId):i.dataset.action==="toggle-simulation"?(o=this.engineToggle)==null||o.call(this):i.dataset.action==="open-map-tab"&&this.openMapTab(this.latestAsciiMap))})}render(t,e,i){this.questCompleteHandler=e,this.engineToggle=i;const n=performance.now(),o=n-this.lastRenderTime;if(o<this.renderThrottleMs){this.pendingRender||(this.pendingRender=!0,setTimeout(()=>{this.pendingRender=!1,this.render(t,e,i)},this.renderThrottleMs-o));return}this.lastRenderTime=n;const r=Math.floor(t.timeOfDaySec/3600),a=Math.floor(t.timeOfDaySec%3600/60),d=`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`,c=t.simRunning?"gm-action-btn gm-action-btn-active":"gm-action-btn",l=t.simRunning?"Pause simulation":"Start simulation",h=this.renderAsciiMap(t);this.latestAsciiMap=h,this.updateMapWindow(h),this.rootElement.innerHTML=`
      <div class="gm-stage">
        <div class="gm-layout">
          <!-- Left action bar -->
          <aside class="gm-actions" aria-label="Actions">
            <button class="${c}" data-action="toggle-simulation" title="${l}">üåû</button>
            <button class="gm-action-btn" data-action="quests" title="Quests">‚öîÔ∏è</button>
            <button class="gm-action-btn" data-action="tavern" title="Tavern">üç∫</button>
            <button class="gm-action-btn" data-action="market" title="Market">üß∫</button>
            <button class="gm-action-btn" data-action="settings" title="Settings">‚öôÔ∏è</button>
          </aside>

          <!-- Center room -->
          <main class="gm-room">
            <div class="gm-hud">
              <div class="gm-hud-card">
                <div class="gm-hud-title">Day</div>
                <div class="gm-hud-value">${t.day}</div>
              </div>

              <div class="gm-hud-card">
                <div class="gm-hud-title">Time</div>
                <div class="gm-hud-value">${d}</div>
              </div>

              <div class="gm-hud-card">
                <div class="gm-hud-title">Gold</div>
                <div class="gm-hud-value gm-hud-gold">${t.player.gold} pix</div>
              </div>

              <div class="gm-hud-card">
                <div class="gm-hud-title">Guildmaster</div>
                <div class="gm-hud-value">${t.player.name}</div>
              </div>
            </div>

            <div class="gm-room-content">
              <section class="gm-card">
                <h2>Guild Hall Interior</h2>
                <div class="gm-small">
                  The "room" here is just a panel for now ‚Äî later NPCs can walk behind it on a canvas layer.
                </div>
                <div style="height: 10px"></div>
                <div class="gm-list">
                  <div class="gm-quest">
                    <div class="gm-quest-title">
                      <span>üìå Status</span>
                      <span>Level ${t.player.level}</span>
                    </div>
                    <div class="gm-quest-desc">
                      Experience: ${t.player.experience} XP | NPCs: ${t.npcs.length} | ${t.simRunning?"‚ñ∂Ô∏è Running":"‚è∏Ô∏è Paused"}
                    </div>
                  </div>

                  <div class="gm-quest">
                    <div class="gm-quest-title">
                      <span>üè∞ Goal</span>
                      <span style="color: rgba(255,255,255,0.75)">Rebuild the Guild</span>
                    </div>
                    <div class="gm-quest-desc">
                      Sponsor adventurers, organize quests, and control the flow of gold.
                    </div>
                  </div>
                </div>
              </section>

              <section class="gm-card gm-map-card">
                <div class="gm-map-header">
                  <div>
                    <h2>City Map (ASCII)</h2>
                    <div class="gm-small">
                      NPCs wander between points of interest. Letters = NPC initials, capitals = POIs, > = someone en route, * = crowded tile.
                    </div>
                  </div>
                  <div class="gm-map-legend gm-small">
                    <div><span class="gm-map-key gm-road"></span> Road</div>
                    <div><span class="gm-map-key gm-building"></span> Building</div>
                    <div><span class="gm-map-key gm-water"></span> Water</div>
                    <button class="gm-map-open" data-action="open-map-tab" title="Open map in a new tab">Open full map</button>
                  </div>
                </div>
                <pre class="gm-ascii-map" aria-label="ASCII city map">${h}</pre>
              </section>

              <section class="gm-card">
                <h2>Quest Board</h2>
                <div class="gm-scroll" style="max-height: 100%;">
                  <div class="gm-list">
                    ${t.quests.slice().reverse().map(u=>{const m=u.completed;return`
                          <div class="gm-quest" style="${m?"border-left-color: rgba(0, 255, 136, 0.7);":""}">
                            <div class="gm-quest-title">
                              <span>${u.title}${m?" ‚úì":""}</span>
                              <span class="gm-hud-gold">${u.reward}üí∞</span>
                            </div>
                            <div class="gm-quest-desc">${u.description}</div>
                            ${m?'<div class="gm-small" style="margin-top:8px; color: rgba(0,255,136,0.9); font-weight: 900;">‚úì Completed</div>':`<button class="gm-quest-btn" data-quest-id="${u.id}">Complete</button>`}
                          </div>
                        `}).join("")}
                  </div>
                </div>
              </section>
            </div>
          </main>

          <!-- Right panels -->
          <aside class="gm-right">
            <section class="gm-card">
              <h2>Summary</h2>
              <div class="gm-small">
                Day ${t.day}, ${d}. The guild has ${t.npcs.length} NPCs working and living in the city.
                ${t.simRunning?"The simulation is running.":"Click the ‚òÄÔ∏è button to start the simulation."}
              </div>
            </section>

            <section class="gm-card">
              <h2>Journal</h2>
              <div class="gm-scroll gm-small" id="gm-log">
                ${t.reportLog.slice().reverse().map(u=>`<div>‚Ä¢ ${u.message}</div>`).join("")}
              </div>
            </section>
          </aside>
        </div>
      </div>
    `}renderAsciiMap(t){const e=t.worldMap,i=2,n=Math.ceil(e.width/i),o=Math.ceil(e.height/i),r=new Map;t.npcs.forEach(c=>{const l=Math.floor(c.pos.x/i),h=Math.floor(c.pos.y/i),u=`${l},${h}`,m=r.get(u),f=c.name.charAt(0).toUpperCase()||"@";m?r.set(u,{count:m.count+1,label:m.count+1>1?"*":m.label,hasTarget:m.hasTarget||!!c.targetPos}):r.set(u,{count:1,label:f,hasTarget:!!c.targetPos})});const a=new Map;e.getPOIs().forEach(c=>{const l=Math.floor(c.pos.x/i),h=Math.floor(c.pos.y/i),u=`${l},${h}`;a.set(u,c.name.charAt(0).toUpperCase())});const d=[];for(let c=0;c<o;c++){let l="";for(let h=0;h<n;h++){const u=`${h},${c}`,m=r.get(u);if(m){l+=m.count>1?"*":m.hasTarget?">":m.label;continue}const f=a.get(u);if(f){l+=f;continue}const y=e.getTile(h*i,c*i);switch(y==null?void 0:y.type){case it.Road:l+="¬∑";break;case it.Building:l+="#";break;case it.Water:l+="~";break;default:l+=" ";break}}d.push(l)}return d.join(`
`)}openMapTab(t){if(this.mapWindow&&this.mapWindow.closed&&(this.mapWindow=null),!this.mapWindow){if(this.mapWindow=window.open("","guildmaster-map","noopener,noreferrer"),!this.mapWindow)return;const e=this.mapWindow.document;e.open(),e.write(`
        <!doctype html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <title>GuildMaster Map</title>
            <style>
              :root {
                color-scheme: dark;
              }
              body {
                margin: 0;
                background: #05070b;
                color: #aef7b0;
                font-family: "SFMono-Regular", Consolas, "Liberation Mono", monospace;
                display: grid;
                grid-template-rows: auto 1fr;
                min-height: 100vh;
              }
              header {
                padding: 14px 18px 8px 18px;
                color: rgba(255,255,255,0.78);
                font-weight: 700;
                letter-spacing: 0.02em;
                background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.35));
                border-bottom: 1px solid rgba(255,255,255,0.08);
                position: sticky;
                top: 0;
              }
              pre {
                margin: 0;
                padding: 18px;
                white-space: pre;
                font-size: 12px;
                line-height: 1.2;
                overflow: auto;
              }
            </style>
          </head>
          <body>
            <header>GuildMaster City Map (live)</header>
            <pre id="gm-map-view" aria-label="Full ASCII city map"></pre>
          </body>
        </html>
      `),e.close()}this.updateMapWindow(t)}updateMapWindow(t){if(!this.mapWindow||this.mapWindow.closed){this.mapWindow=null;return}const e=this.mapWindow.document.getElementById("gm-map-view");e&&(e.textContent=t)}}function Mt(){const s=document.getElementById("app");if(!s){console.error("App root element not found");return}const t=new ve,e=new Ie(s),i=a=>{t.completeQuest(a)&&console.log(`Quest ${a} completed!`)},n=()=>{t.toggle()};e.render(t.getState(),i,n),t.subscribe(a=>{e.render(a,i,n)});let o=performance.now();function r(a){const d=a-o;o=a,t.update(d),requestAnimationFrame(r)}requestAnimationFrame(r),console.log("GuildMaster game initialized!")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Mt):Mt();
//# sourceMappingURL=index-DtkojTlM.js.map
